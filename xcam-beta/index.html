<html lang="pt-BR">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>XCam - Transmissões ao Vivo</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            'xcam-yellow': '#FFD700',
            'xcam-pink': '#FF007F',
            'xcam-orange': '#FF4500',
            'xcam-blue': '#4169E1',
            'xcam-purple': '#800080',
          },
          fontFamily: {
            'inter': ['Inter', 'sans-serif'],
          },
        }
      }
    }
  </script>
  <style>
    body {
      font-family: 'Inter', sans-serif;
      background-color: #121212;
      color: white;
    }

    .card-hover:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
    }

    .carousel-item {
      transition: opacity 0.5s ease-in-out;
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
    }

    .toast {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 9999;
      animation: slideIn 0.3s ease, fadeOut 0.5s ease 2.5s forwards;
    }

    @keyframes slideIn {
      from {
        transform: translateX(100%);
        opacity: 0;
      }

      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    @keyframes fadeOut {
      from {
        opacity: 1;
      }

      to {
        opacity: 0;
        visibility: hidden;
      }
    }

    .loader {
      width: 48px;
      height: 48px;
      border: 5px solid #FFF;
      border-bottom-color: #FF007F;
      border-right-color: #4169E1;
      border-top-color: #FFD700;
      border-radius: 50%;
      display: inline-block;
      box-sizing: border-box;
      animation: rotation 1s linear infinite;
    }

    @keyframes rotation {
      0% {
        transform: rotate(0deg);
      }

      100% {
        transform: rotate(360deg);
      }
    }

    .badge-live {
      background: linear-gradient(90deg, #FF007F, #FF4500);
      animation: pulse 1.5s infinite;
    }

    @keyframes pulse {
      0% {
        opacity: 1;
      }

      50% {
        opacity: 0.7;
      }

      100% {
        opacity: 1;
      }
    }

    .pagination-btn {
      transition: all 0.2s ease;
    }

    .pagination-btn:hover:not(.pagination-active) {
      background-color: rgba(255, 255, 255, 0.1);
    }

    .pagination-active {
      background: linear-gradient(90deg, #FF007F, #4169E1);
    }

    /* Retro elements */
    .retro-grid {
      background-image: linear-gradient(rgba(64, 64, 64, 0.1) 1px, transparent 1px),
        linear-gradient(90deg, rgba(64, 64, 64, 0.1) 1px, transparent 1px);
      background-size: 20px 20px;
    }

    .retro-glow {
      box-shadow: 0 0 10px rgba(255, 215, 0, 0.5),
        0 0 20px rgba(255, 0, 127, 0.3);
    }

    /* Modal styles */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.8);
      z-index: 1000;
      overflow-y: auto;
    }

    .modal-content {
      background-color: #1a1a1a;
      border-radius: 8px;
      margin: 20px auto;
      width: 90%;
      max-width: 1200px;
      animation: modalFadeIn 0.3s;
    }

    @keyframes modalFadeIn {
      from {
        opacity: 0;
        transform: translateY(-20px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .close-modal {
      position: absolute;
      top: 15px;
      right: 15px;
      font-size: 24px;
      cursor: pointer;
      z-index: 1001;
      width: 40px;
      height: 40px;
      background-color: rgba(0, 0, 0, 0.5);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .close-modal:hover {
      background-color: rgba(255, 0, 127, 0.5);
    }

    /* Country flags */
    .flag-icon {
      width: 20px;
      height: 15px;
      display: inline-block;
      vertical-align: middle;
      margin-right: 5px;
      background-size: contain;
      background-position: center;
      background-repeat: no-repeat;
      border-radius: 2px;
    }

    /* Estilos para o container da pré-visualização */
    .card-preview-container {
      position: relative;
      width: 100%;
      aspect-ratio: 16 / 9;
      background-color: #000;
      cursor: pointer;
      /* Fundo preto enquanto o iframe carrega */
    }

    .card-preview-container .badge-live,
    .card-preview-container .absolute.bottom-2.right-2 {
      z-index: 20;
      pointer-events: none;
    }

    .card-preview-container iframe {
      aspect-ratio: 16/9;
      width: 100%;
      height: 100%;
      position: absolute;
      inset: 0;
      z-index: 10;
    }

    .card-preview-container img.card-poster {
      aspect-ratio: 16/9;
      width: 100%;
      height: 100%;
      object-fit: cover;
      position: absolute;
      inset: 0;
      z-index: 5;
    }

    /* Efeito gradiente para tags dos cards */
    .card-tag {
      background: #232323;
      color: #ccc;
      transition: background 0.3s, color 0.3s, box-shadow 0.2s;
      box-shadow: 0 2px 8px rgba(255, 0, 127, 0.10);
      cursor: pointer;
      border-radius: 999px;
      padding: 0.25rem 0.75rem;
      font-size: 0.75rem;
      display: inline-block;
    }

    .card-tag:hover {
      background: linear-gradient(90deg, #FF007F, #800080);
      color: #fff;
      box-shadow: 0 2px 8px rgba(255, 0, 127, 0.25);
    }
  </style>
  <meta name="6a97888e-site-verification" content="15989ae96dff82fe33826928ae653613">
  <link rel="manifest" href="/manifest.json">
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
</head>

<body class="min-h-screen">
  <div id="toast" class="toast hidden bg-xcam-blue p-4 rounded-lg shadow-lg max-w-xs">
    <div class="flex items-center">
      <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
      </svg>
      <span id="toast-message">Notificação</span>
    </div>
  </div>

  <header class="bg-gradient-to-r from-gray-900 to-black border-b border-gray-800 sticky top-0 z-50">
    <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-3">
      <div class="flex flex-wrap items-center justify-between">
        <div class="flex items-center">
          <img src="https://github.com/SamuelPassamani/XCam/raw/refs/heads/main/xcam-beta/src/logo.svg" alt="XCam Logo" class="h-10">
        </div>

        <nav class="hidden md:flex items-center space-x-6">
          <a href="#" class="text-white hover:text-xcam-yellow transition-colors">Início</a>
          <a href="#" class="text-white hover:text-xcam-pink transition-colors">Explorar</a>
          <a href="#" class="text-white hover:text-xcam-orange transition-colors">Categorias</a>
          <a href="#" class="bg-gradient-to-r from-xcam-pink to-xcam-purple px-4 py-2 rounded-full font-medium hover:opacity-90 transition-opacity">Transmitir</a>
        </nav>

        <div class="hidden md:block w-full md:w-auto mt-4 md:mt-0 order-3 md:order-2">
          <div class="relative">
            <input type="text" id="search-input" placeholder="Buscar transmissões..." class="w-full md:w-64 lg:w-80 bg-gray-800 text-white rounded-full py-2 px-4 pl-10 focus:outline-none focus:ring-2 focus:ring-xcam-pink">
            <svg class="w-5 h-5 text-gray-400 absolute left-3 top-2.5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
            </svg>
          </div>
        </div>

        <button id="mobile-menu-button" class="md:hidden text-white focus:outline-none order-2" aria-label="Abrir menu de navegação">
          <span class="sr-only">Abrir menu de navegação</span>
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
          </svg>
        </button>
      </div>

      <div id="mobile-menu" class="md:hidden hidden mt-4 pb-2">
        <div class="flex flex-col space-y-3">
          <a href="#" class="text-white hover:text-xcam-yellow transition-colors">Início</a>
          <a href="#" class="text-white hover:text-xcam-pink transition-colors">Explorar</a>
          <a href="#" class="text-white hover:text-xcam-orange transition-colors">Categorias</a>
          <a href="#" class="bg-gradient-to-r from-xcam-pink to-xcam-purple px-4 py-2 rounded-full font-medium hover:opacity-90 transition-opacity text-center">Transmitir</a>
          <div class="relative mt-2">
            <input type="text" id="mobile-search-input" placeholder="Buscar transmissões..." class="w-full bg-gray-800 text-white rounded-full py-2 px-4 pl-10 focus:outline-none focus:ring-2 focus:ring-xcam-pink">
            <svg class="w-5 h-5 text-gray-400 absolute left-3 top-2.5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
            </svg>
          </div>
        </div>
      </div>
    </div>
  </header>

  <main class="container mx-auto px-4 sm:px-6 lg:px-8 py-6">
    <div class="flex flex-col lg:flex-row gap-6">
      <aside class="w-full lg:w-1/4 space-y-6">
        <div class="bg-gray-900 rounded-xl p-4 border border-gray-800">
          <h3 class="text-xl font-bold mb-4 text-white">Filtros</h3>
          <div class="space-y-4">
            <div>
              <label for="filter-country" class="block text-gray-300 mb-2">País</label>
              <select id="filter-country" class="w-full bg-gray-800 text-white rounded-lg py-2 px-3 focus:outline-none focus:ring-2 focus:ring-xcam-pink">
                <option value="">Todos os países</option>
                <!-- Options will be dynamically populated by JavaScript -->
              </select>
            </div>
            <div>
              <label class="block text-gray-300 mb-2">Gênero</label>
              <select id="filter-gender" title="Gênero" class="w-full bg-gray-800 text-white rounded-lg py-2 px-3 focus:outline-none focus:ring-2 focus:ring-xcam-pink">
                <option value="">Todos</option>
                <option value="male">Masculino</option>
                <option value="female">Feminino</option>
                <option value="trans">Trans</option>
                <option value="couple">Casal</option>
              </select>
            </div>
            <div>
              <label class="block text-gray-300 mb-2">Orientação</label>
              <select id="filter-orientation" title="Orientação" class="w-full bg-gray-800 text-white rounded-lg py-2 px-3 focus:outline-none focus:ring-2 focus:ring-xcam-pink">
                <option value="">Todas</option>
                <option value="straight">Hetero</option>
                <option value="gay">Gay</option>
                <option value="lesbian">Lésbica</option>
                <option value="bisexual">Bissexual</option>
              </select>
            </div>
            <button id="apply-filters" class="w-full bg-gradient-to-r from-xcam-pink to-xcam-purple py-2 rounded-lg font-medium hover:opacity-90 transition-opacity">Aplicar Filtros</button>
            <button id="surprise-me-btn" class="w-full bg-gradient-to-r from-xcam-yellow to-xcam-orange py-2 rounded-lg font-medium hover:opacity-90 transition-opacity flex items-center justify-center">
              ✨ Surpreenda-me
            </button>
          </div>
        </div>

        <!-- ANÚNCIO 160 x 600 -->
        <div class="h-[600px] w-[160px] mx-auto rounded-lg flex items-center justify-center">
          <script type="text/javascript">
            atOptions = {
              'key': '434854185c362cb10313038308c5724a',
              'format': 'iframe',
              'height': 600,
              'width': 160,
              'params': {}
            };
          </script>
          <script type="text/javascript" src="https://www.highperformanceformat.com/434854185c362cb10313038308c5724a/invoke.js"></script>
        </div>
      </aside>
      <div class="w-full lg:w-3/4 flex flex-col gap-6">
        <section class="relative overflow-hidden rounded-xl retro-glow">
          <div id="carousel" class="relative h-64 md:h-80 lg:h-96">
            <div id="carousel-items" class="h-full">
            </div>

            <button id="prev-slide" class="absolute left-4 top-1/2 transform -translate-y-1/2 bg-black bg-opacity-50 rounded-full p-2 z-20 hover:bg-opacity-70 transition-all" title="Anterior">
              <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
              </svg>
            </button>
            <button id="next-slide" class="absolute right-4 top-1/2 transform -translate-y-1/2 bg-black bg-opacity-50 rounded-full p-2 z-20 hover:bg-opacity-70 transition-all" title="Próximo">
              <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
              </svg>
            </button>

            <div class="absolute bottom-4 left-1/2 transform -translate-x-1/2 flex space-x-2 z-20" id="carousel-indicators">
            </div>
          </div>
        </section>

        <section class="bg-gray-900 rounded-xl p-4 border border-gray-800">
          <h3 class="text-xl font-bold mb-4 text-white">Streamers em Alta</h3>
          <div id="top-streamers" class="space-y-3">
            <div class="animate-pulse">
              <div class="flex items-center space-x-3">
                <div class="w-10 h-10 bg-gray-700 rounded-full"></div>
                <div class="flex-1">
                  <div class="h-4 bg-gray-700 rounded w-3/4 mb-2"></div>
                  <div class="h-3 bg-gray-700 rounded w-1/2"></div>
                </div>
              </div>
            </div>
            <div class="animate-pulse">
              <div class="flex items-center space-x-3">
                <div class="w-10 h-10 bg-gray-700 rounded-full"></div>
                <div class="flex-1">
                  <div class="h-4 bg-gray-700 rounded w-3/4 mb-2"></div>
                  <div class="h-3 bg-gray-700 rounded w-1/2"></div>
                </div>
              </div>
            </div>
            <div class="animate-pulse">
              <div class="flex items-center space-x-3">
                <div class="w-10 h-10 bg-gray-700 rounded-full"></div>
                <div class="flex-1">
                  <div class="h-4 bg-gray-700 rounded w-3/4 mb-2"></div>
                  <div class="h-3 bg-gray-700 rounded w-1/2"></div>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- ANÚNCIO 728 x 90 -->
        <div class="h-[90px] w-full max-w-[728px] mx-auto mb-6 rounded-lg flex items-center justify-center">
          <script type="text/javascript">
            atOptions = {
              'key': 'c102292f689885d28f845f1e79b13d44',
              'format': 'iframe',
              'height': 90,
              'width': 728,
              'params': {}
            };
          </script>
          <script type="text/javascript" src="https://www.highperformanceformat.com/c102292f689885d28f845f1e79b13d44/invoke.js"></script>
        </div>

        <div class="mb-6">
          <h2 id="broadcasts-title" class="text-2xl md:text-3xl font-bold mb-4 text-white">Transmissões ao Vivo</h2>

          <div id="loading-state" class="flex flex-col items-center justify-center py-12">
            <span class="loader mb-4"></span>
            <p class="text-gray-400">Carregando transmissões...</p>
          </div>

          <div id="error-state" class="hidden flex flex-col items-center justify-center py-12 text-center">
            <svg class="w-16 h-16 text-xcam-pink mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
            <h3 class="text-xl font-bold mb-2">Ops! Algo deu errado</h3>
            <p class="text-gray-400 mb-4">Não foi possível carregar as transmissões.</p>
            <button id="retry-button" class="bg-xcam-blue px-6 py-2 rounded-full font-medium hover:bg-opacity-90 transition-colors">Tentar novamente</button>
          </div>

          <div id="empty-state" class="hidden flex flex-col items-center justify-center py-12 text-center">
            <svg class="w-16 h-16 text-gray-500 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"></path>
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z"></path>
            </svg>
            <h3 class="text-xl font-bold mb-2">Nenhuma transmissão encontrada</h3>
            <p class="text-gray-400">Tente ajustar seus filtros ou volte mais tarde.</p>
          </div>

          <div id="broadcasts-grid" class="hidden grid grid-cols-1 sm:grid-cols-2 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 2xl:grid-cols-5 gap-4">
          </div>
        </div>

        <div id="pagination" class="flex justify-center items-center space-x-2 mt-8 hidden">
          <button id="first-page" class="pagination-btn bg-gray-800 hover:bg-gray-700 text-white rounded-md px-3 py-1 text-sm">Primeira</button>
          <button id="prev-page" class="pagination-btn bg-gray-800 hover:bg-gray-700 text-white rounded-md px-3 py-1 text-sm">Anterior</button>
          <div id="page-numbers" class="flex space-x-2">
          </div>
          <button id="next-page" class="pagination-btn bg-gray-800 hover:bg-gray-700 text-white rounded-md px-3 py-1 text-sm">Próxima</button>
          <button id="last-page" class="pagination-btn bg-gray-800 hover:bg-gray-700 text-white rounded-md px-3 py-1 text-sm">Última</button>
        </div>

        <!-- ANÚNCIO 468 x 60 -->
        <div class="h-[60px] w-full max-w-[468px] mx-auto mt-8 rounded-lg flex items-center justify-center">
          <script type="text/javascript">
            atOptions = {
              'key': '6b7302ae54abd711d19d17f075a8e293',
              'format': 'iframe',
              'height': 60,
              'width': 468,
              'params': {}
            };
          </script>
          <script type="text/javascript" src="https://www.highperformanceformat.com/6b7302ae54abd711d19d17f075a8e293/invoke.js"></script>
        </div>
      </div>
    </div>
  </main>

  <div id="broadcast-modal" class="modal">
    <span class="close-modal">&times;</span>
    <div class="modal-content p-4 md:p-6">
      <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <div class="lg:col-span-2">
          <div class="relative aspect-video bg-black rounded-lg overflow-hidden">
            <div id="modal-player" class="w-full h-full flex items-center justify-center">
              <img id="modal-thumbnail" src="" alt="Thumbnail" class="absolute inset-0 w-full h-full object-cover">
            </div>
            <iframe id="modal-iframe" class="w-full h-full absolute inset-0" frameborder="0" allowfullscreen></iframe>
          </div>

          <div class="mt-4">
            <div class="flex items-center justify-between">
              <div class="flex items-center">
                <img id="modal-avatar" src="" alt="Avatar" class="w-12 h-12 rounded-full mr-3">
                <div>
                  <h3 id="modal-username" class="text-xl font-bold">Carregando...</h3>
                  <div class="flex items-center text-gray-400">
                    <span id="modal-country-flag" class="flag-icon"></span>
                    <span id="modal-country-name">Carregando...</span>
                  </div>
                </div>
              </div>
              <div class="text-right">
                <div class="badge-live px-2 py-1 rounded-md text-white text-sm font-medium">AO VIVO</div>
                <div class="text-gray-400 mt-1"><span id="modal-viewers">0</span> espectadores</div>
              </div>
            </div>

            <div class="mt-4 flex flex-wrap gap-2">
              <span id="modal-gender" class="bg-gray-800 text-gray-300 px-3 py-1 rounded-full text-sm flex items-center"></span>
              <span id="modal-orientation" class="bg-gray-800 text-gray-300 px-3 py-1 rounded-full text-sm flex items-center"></span>
              <span id="modal-type" class="bg-gray-800 text-gray-300 px-3 py-1 rounded-full text-sm flex items-center"></span>
            </div>

            <div id="modal-tags" class="mt-3 flex flex-wrap gap-2">
            </div>

            <!-- Gemini Bio Section -->
            <div id="gemini-bio-section" class="mt-4">
              <button id="generate-bio-btn" class="w-full bg-gradient-to-r from-xcam-blue to-xcam-purple py-2 rounded-lg font-medium hover:opacity-90 transition-opacity flex items-center justify-center">
                ✨ Gerar Biografia com IA
              </button>
              <div id="gemini-bio-content" class="mt-2 p-3 bg-gray-800 rounded-lg text-gray-300 hidden"></div>
            </div>

          </div>
        </div>

        <div class="lg:col-span-1">
          <h3 class="text-xl font-bold mb-4">Transmissões Relacionadas</h3>
          <div id="related-broadcasts" class="space-y-4">
            <div class="animate-pulse">
              <div class="aspect-video bg-gray-700 rounded-lg mb-2"></div>
              <div class="h-4 bg-gray-700 rounded w-3/4 mb-2"></div>
              <div class="h-3 bg-gray-700 rounded w-1/2"></div>
            </div>
            <div class="animate-pulse">
              <div class="aspect-video bg-gray-700 rounded-lg mb-2"></div>
              <div class="h-4 bg-gray-700 rounded w-3/4 mb-2"></div>
              <div class="h-3 bg-gray-700 rounded w-1/2"></div>
            </div>
          </div>

          <!-- ANÚNCIO 300 x 250 -->
          <div class="h-[250px] w-[300px] mx-auto mt-6 rounded-lg flex items-center justify-center">
            <script type="text/javascript">
              atOptions = {
                'key': 'f1784416e784eb3e8921b75e7a1b00c5',
                'format': 'iframe',
                'height': 250,
                'width': 300,
                'params': {}
              };
            </script>
            <script type="text/javascript" src="https://www.highperformanceformat.com/f1784416e784eb3e8921b75e7a1b00c5/invoke.js"></script>
          </div>
        </div>
      </div>
    </div>
  </div>

  <footer class="bg-gray-900 border-t border-gray-800 mt-12 py-8">
    <div class="container mx-auto px-4 sm:px-6 lg:px-8">
      <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
        <div>
          <img src="https://github.com/SamuelPassamani/XCam/raw/refs/heads/main/xcam-beta/src/logo.svg" alt="XCam Logo" class="h-8 mb-4">
          <p class="text-gray-400 mb-4">A melhor plataforma para transmissões ao vivo com design moderno e retro.</p>
          <div class="flex space-x-4">
            <a href="#" class="text-gray-400 hover:text-xcam-pink transition-colors" title="Twitter">
              <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723 10.054 10.054 0 01-3.127 1.184 4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z" />
              </svg>
            </a>
            <a href="#" class="text-gray-400 hover:text-xcam-pink transition-colors" title="Instagram">
              <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zM12 5.838a6.162 6.162 0 100 12.324 6.162 6.162 0 000-12.324zM12 16a4 4 0 110-8 4 4 0 010 8zm6.406-11.845a1.44 1.44 0 100 2.881 1.44 1.44 0 000-2.881z" />
              </svg>
            </a>
            <a href="#" class="text-gray-400 hover:text-xcam-pink transition-colors" title="Facebook">
              <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M22.675 0H1.325C.593 0 0 .593 0 1.325v21.351C0 23.407.593 24 1.325 24H12.82v-9.294H9.692v-3.622h3.128V8.413c0-3.1 1.893-4.788 4.659-4.788 1.325 0 2.463.099 2.795.143v3.24l-1.918.001c-1.504 0-1.795.715-1.795 1.763v2.313h3.587l-.467 3.622h-3.12V24h6.116c.73 0 1.323-.593 1.323-1.325V1.325C24 .593 23.407 0 22.675 0z" />
              </svg>
            </a>
          </div>
        </div>

        <div class="grid grid-cols-2 gap-4">
          <div>
            <h3 class="text-white font-bold mb-4">Navegação</h3>
            <ul class="space-y-2">
              <li><a href="#" class="text-gray-400 hover:text-xcam-pink transition-colors">Início</a></li>
              <li><a href="#" class="text-white hover:text-xcam-pink transition-colors">Explorar</a></li>
              <li><a href="#" class="text-white hover:text-xcam-pink transition-colors">Categorias</a></li>
              <li><a href="#" class="text-white hover:text-xcam-pink transition-colors">Transmitir</a></li>
            </ul>
          </div>
          <div>
            <h3 class="text-white font-bold mb-4">Suporte</h3>
            <ul class="space-y-2">
              <li><a href="#" class="text-gray-400 hover:text-xcam-pink transition-colors">Ajuda</a></li>
              <li><a href="#" class="text-gray-400 hover:text-xcam-pink transition-colors">Contato</a></li>
              <li><a href="#" class="text-gray-400 hover:text-xcam-pink transition-colors">Termos de Uso</a></li>
              <li><a href="#" class="text-gray-400 hover:text-xcam-pink transition-colors">Privacidade</a></li>
            </ul>
          </div>
        </div>

        <div>
          <!-- ANÚNCIO 320 x 50 -->
          <div class="h-[50px] w-[320px] mx-auto mb-4 rounded-lg flex items-center justify-center">
            <script type="text/javascript">
              atOptions = {
                'key': '86125e96829d2dff85e55f10406512f0',
                'format': 'iframe',
                'height': 50,
                'width': 320,
                'params': {}
              };
            </script>
            <script type="text/javascript" src="https://www.highperformanceformat.com/86125e96829d2dff85e55f10406512f0/invoke.js"></script>
          </div>
          <p class="text-gray-500 text-sm text-center">© 2025 XCam.World Todos os direitos reservados.</p>
        </div>
      </div>
    </div>
  </footer>

  <!-- Age Gate Modal -->
  <div id="age-gate-modal" class="fixed inset-0 z-[100] hidden items-center justify-center bg-black bg-opacity-90 p-4">
    <div class="bg-[#111] text-center p-8 rounded-lg max-w-lg w-full border border-gray-700 shadow-lg shadow-xcam-pink/20">
      <img src="https://github.com/SamuelPassamani/XCam/raw/refs/heads/main/xcam-beta/src/logo.svg" alt="XCam Logo" class="h-12 mx-auto mb-6">
      <h2 class="text-3xl font-bold text-white mb-4">Este é um site adulto</h2>
      <p class="text-gray-400 mb-6">
        Este site contém material com restrição de idade, incluindo nudez e representações explícitas de atividade sexual. Ao continuar, você afirma que tem pelo menos 18 anos de idade ou a maioridade na jurisdição de onde está acessando o site e que consente em visualizar conteúdo sexualmente explícito.
      </p>
      <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
        <button id="age-confirm-btn" class="w-full bg-xcam-pink text-black font-bold py-3 rounded-lg hover:opacity-90 transition-opacity">Tenho 18 anos ou mais - Entrar</button>
        <button id="age-deny-btn" class="w-full bg-gray-700 text-white font-bold py-3 rounded-lg hover:bg-gray-600 transition-opacity">Tenho menos de 18 anos - Sair</button>
      </div>
      <p class="text-xs text-gray-500 mt-6">
        &copy; XCam.gay, 2025
      </p>
    </div>
  </div>

  <script type="module">
    // Importa as traduções do script externo
    import {
      COUNTRY_NAMES,
      TRANSLATIONS
    } from 'https://cdn.jsdelivr.net/gh/SamuelPassamani/XCam@main/xcam-beta/translations.js';
    // --- LÓGICA DA APLICAÇÃO ---
    // Constantes para os ícones
    const GENDER_ICON_SVG = "data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz48IS0tIFVwbG9hZGVkIHRvOiBTVkcgUmVwbywgd3d3LnN2Z3JlcG8uY29tLCBHZW5lcmF0b3I6IFNWRyBSZXBvIE1peGVyIFRvb2xzIC0tPgo8c3ZnIGZpbGw9IiNGRkZGRkYiIHdpZHRoPSI4MDBweCIgaGVpZHRoPSI4MDBweCIgdmlld0JveD0iMCAwIDI1NiAyNTYiIGlkPSJGbGF0IiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgogIDxwYXRoIGQ9Ik0yMTkuOTk3OCwyMy45NTU1N3EtLjAwMjE5LS41Njk4NC0uMDU3NDktMS4xMzgxOWMtLjAxOC0uMTg0MDgtLjA1MjM3LS4zNjI3OS0uMDc4NDktLjU0NDQzLS4wMjk3OS0uMjA1NTctLjA1MzcxLS40MTIxMS0uMDk0MjQtLjYxNjIxLS4wNDAyOS0uMjAzNjItLjA5NjA3LS40MDA4OC0uMTQ2NDktLjYwMDU5LS4wNDU0MS0uMTgwMTctLjA4NDg0LS4zNjA4NC0uMTM4NjctLjUzOTA2LS4wNTg4NC0uMTk0MzQtLjEzMTU5LS4zODEzNS0uMTk5NzEtLjU3MTI5LS4wNjQ0NS0uMTc5NjktLjEyMzUzLS4zNjA4NC0uMTk2NzctLjUzNzYtLjA3MzQ5LS4xNzcyNC0uMTU5NjctLjM0NjY4LS4yNDEwOS0uNTE5NTMtLjA4NTgyLS4xODIxMy0uMTY2ODctLjM2NjIxLS4yNjI1Ny0uNTQ0OTItLjA4OC0uMTY0NTUtLjE4ODI0LS4zMjAzMS0uMjgzNy0uNDgwNDctLjEwNTM0LS4xNzYyNy0uMjA1Mi0uMzU1LS4zMjAzMS0uNTI2ODUtLjExNTcyLS4xNzMzNC0uMjQ0NzUtLjMzNTQ1LS4zNjktLjUwMi0uMTEtLjE0NzQ2LS4yMTI1Mi0uMjk4MzQtLjMzMDItLjQ0MTQtLjIzNDYyLS4yODYxNC0uNDgzNC0uNTU5NTctLjc0MzE2LS44MjIyNy0uMDE3ODItLjAxODA3LS4wMzI0Ny0uMDM4MDktLjA1MDU0LS4wNTYxNS0uMDE4MzEtLjAxODU2LS4wMzg1Ny0uMDMzMi0uMDU2ODgtLjA1MTI3cS0uMzk0NDEtLjM4OTY2LS44MjIyNy0uNzQzMTdjLS4xMzk2NS0uMTE0NzQtLjI4Njg2LS4yMTQzNS0uNDMwNDItLjMyMTc3LS4xNjk5Mi0uMTI3LS4zMzYwNi0uMjU4NzktLjUxMjY5LS4zNzctLjE2ODgzLS4xMTMyOC0uMzQ0MjQtLjIxMDkzLS41MTczNC0uMzE0NDUtLjE2MzMzLS4wOTc2NS0uMzIzMjQtLjIwMDE5LS40OTE0NS0uMjktLjE3MzEtLjA5Mjc3LS4zNTEyLS4xNzA5LS41Mjc1OS0uMjU0MzktLjE3ODcxLS4wODQ0OC0uMzU0NjItLjE3MzgzLS41MzgtLjI0OTUxLS4xNjkzMi0uMDcwMzItLjM0MjI5LS4xMjY0Ny0uNTE0LS4xODg0OC0uMTk3NTEtLjA3MTI5LS4zOTMwNy0uMTQ2NDktLjU5NTM0LS4yMDgtLjE2ODgyLS4wNTA3OC0uMzQwNDUtLjA4Nzg5LS41MTA4Ni0uMTMxMzUtLjIwODc0LS4wNTMyMi0uNDE1MjktLjExMTMyLS42MjgxOC0uMTUzMzItLjE5MDU1LS4wMzc1OS0uMzgzLS4wNTk1Ny0uNTc1MDctLjA4Nzg5LS4xOTU0NC0uMDI4ODEtLjM4ODMxLS4wNjQ5NC0uNTg2NzktLjA4NDQ3LS4zMzI1Mi0uMDMyNzEtLjY2Ni0uMDQ1NDEtLjk5OTg4LS4wNTA3OEMyMDguMTE4NTMsMTIuMDA4MywyMDguMDYwMywxMiwyMDgsMTJIMTcyYTEyLDEyLDAsMCwwLDAsMjRoNy4wMjkzbC0xNS4wNTEsMTUuMDUxMjdBNzEuOTc1MjYsNzEuOTc1MjYsMCwxLDAsMTA4LDE3OC45ODFWMTkySDg4YTEyLDEyLDAsMCwwLDAsMjRoMjB2MTZhMTIsMTIsMCwwLDAsMjQsMFYyMTZoMjBhMTIsMTIsMCwwLDAsMC0yNEgxMzJWMTc4Ljk4MUE3MS45MjgsNzEuOTI4LDAsMCwwLDE4MC4yNzc4Myw2OC42OTI4N0wxOTYsNTIuOTcwN1Y2MGExMiwxMiwwLDAsMCwyNCwwVjI0QzIyMCwyMy45ODQ4NiwyMTkuOTk3OCwyMy45NzAyMSwyMTkuOTk3OCwyMy45NTU1N1pNMTIwLDE1NmE0OCw0OCwwLDEsMSw0OC00OEE0OC4wNTQ2OCw0OC4wNTQ2OCwwLDAsMSwxMjAsMTU2WiIvPgo8L3N2Zz4=";
    const BROADCAST_TYPE_ICON_SVG = "data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KCjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+CjwhLS0gVXBsb2FkZWQgdG86IFNWRyBSZXBvLCB3d3cuc3ZncmVwby5jb20sIEdlbmVyYXRvcjogU1ZHIFJlcG8gTWl4ZXIgVG9vbHMgLS0+CjxzdmcgdmVyc2lvbj0iMS4xIiBpZD0iX3gzMl8iIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIAoJIHdpZHRoPSI4MDBweCIgaGVpZ2h0PSI4MDBweCIgdmlld0JveD0iMCAwIDUxMiA1MTIiICB4bWw6c3BhY2U9InByZXNlcnZlIj4KPHN0eWxlIHR5cGU9InRleHQvY3NzIj4KPCFbQ0RBVEFbCgkuc3Qwe2ZpbGw6I0ZGRkZGRjt9Cl1dPgo8L3N0eWxlPgo8Zz4KCTxwYXRoIGNsYXNzPSJzdDAiIGQ9Ik0xMDMuMTY5LDI1Ni44MjhjNDMuNzAzLDAsNzkuMTI1LTM1LjQzOCw3OS4xMjUtNzkuMTQxYzAtNDMuNjg4LTM1LjQyMi03OS4xMjUtNzkuMTI1LTc5LjEyNQoJCVMyNC4wNDQsMTM0LDI0LjA0NCwxNzcuNjg4QzI0LjA0NCwyMjEuMzkxLDU5LjQ2NiwyNTYuODI4LDEwMy4xNjksMjU2LjgyOHoiLz4KCTxjaXJjbGUgY2xhc3M9InN0MCIgY3g9IjMwMi42MzgiIGN5PSIxNDQuNzE5IiByPSIxMDYuODI4Ii8+Cgk8cGF0aCBjbGFzcz0ic3QwIiBkPSJNMy4wMDAxMiwyODAuMjM0SDc0LjE1M3YxNzEuNDM4YzAsMTIuMzkxLDEwLjA0NywyMi40MzgsMjIuNDM4LDIyLjQzOGgyMzYuMDQ3CgkJYzEyLjM3NSwwLDIyLjQyMi0xMC4wNDcsMjIuNDIyLTIyLjQzOHYtMTQ5QzM1NS4wNiwyOTAuMjgxLDM0NS4wMTMsMjgwLjIzNCwzMzIuNjM4LDI4MC4yMzR6Ii8+Cgk8cmVjdCB4PSIzNzEuMjE2IiB5PSIzMzEuNjcyIiBjbGFzcz0ic3QwIiB3aWR0aD0iMzQuMjk3IiBoZWlnaHQ9Ijk5LjY1NiIvPgoJPHBhdGggY2xhc3M9InN0MCIgZD0iTTUwNi41OTEsMjkzLjQzOGMtMy4zNTktMi4wMzEtNy41NDctMi4xNTYtMTEuMDMxLTAuMzEzbC03My4yMzQsMzguNTQ3djk4LjU0N2w3My4yMzQsMzguNTQ3CgkJYzMuNDg0LDEuODQ0LDcuNjcyLDEuNzE5LDExLjAzMS0wLjMxM3M1LjQwNi01LjY3Miw1LjQwNi05LjYwOVYzMDMuMDQ3QzUxMS45OTcsMjk5LjEwOSw1MDkuOTUsMjk1LjQ2OSw1MDYuNTkxLDI5My40Mzh6Ii8+Cgk8cGF0aCBjbGFzcz0ic3QwIiBkPSJNMC44NTYsMjg3LjE1NmMtMS43MzQsNC4xODgtMC43ODEsOS4wMTYsMi40MzgsMTIuMjM0bDU0LjA0Nyw1NC4wNDd2LTczLjIwM0gxMS4yMTYKCQlDNi42ODUsMjgwLjIzNCwyLjU5MSwyODIuOTY5LDAuODU2LDI4Ny4xNTZ6Ii8+CjwvZz4KPC9zdmc+";
    const ORIENTATION_ICON_SVG = "data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz48c3ZnIHdpZHRoPSI4MDBweCIgaGVpZ2h0PSI4MDBweCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxwYXRoIGZpbGwtcnVsZT0iZXZlbm9kZCIgY2xpcC1ydWxlPSJldmVub2RkIiBkPSJNOC41NTI4NCAzLjAwMDEyQzcuOTM1OTggMy4wMDAxMiA3LjIzODQxIDMuMDY1MTQgNi41NzIwOSAzLjI5MjI0QzIuNTU0OTQgNC42MDM4NyAxLjI2MzQxIDguODk0IDIuMzk4NzcgMTIuNDNMMi40MDM1NCAxMi40NDQ4TDIuNDA4NzcgMTIuNDU5NUMzLjAzNDM1IDE0LjIxNzQgNC4wNDIyNiAxNS44MTI3IDUuMzUzMzYgMTcuMTI0OUw1LjM2MDkxIDE3LjEzMjRMNS4zNjg2MiAxNy4xMzk4QzcuMjM3ODIgMTguOTMyMyA5LjI3MjU0IDIwLjQ5NTMgMTEuNDc1NiAyMS44NTE1TDExLjk5MzQgMjIuMTcwM0wxMi41MTQ3IDIxLjg1NzNDMTQuNzIyNiAyMC41MzE1IDE2Ljc5NjQgMTguOTI1NCAxOC42NDMyIDE3LjE0NzRMMTguNjQ5IDE3LjE0MTlMMTguNjU0NyAxNy4xMzYyQzE5Ljk3NzEgMTUuODIxNSAyMC45ODUxIDE0LjIxNDQgMjEuNjAxNSAxMi40NTQ5TDIxLjYwNjYgMTIuNDQwMkwyMS42MTEzIDEyLjQyNTNDMjIuNzI1MSA4Ljg5NzAzIDIxLjQ0MDEgNC42MDE3NiAxNy40NTA3IDMuMzA5NDhDMTYuNzk3NiAzLjA5MjIxIDE2LjEyMzYgMy4wMDAxMiAxNS40NjQ4IDMuMDAwMTJDMTMuOTgyOCAzLjAwMDExIDEyLjg4NTggMy42MjA2NCAxMi4wMDA0IDQuMjUzMDlDMTEuMTIxOSAzLjYyNTQ1IDEwLjAxNzYgMy4wMDAxMiA4LjU1Mjg0IDMuMDAwMTJaIiBmaWxsPSIjRkZGRkZGIi8+PC9zdmc+";
    // Global variables
    let broadcasts = []; // Acts as a cache for modal details
    let currentPage = 1;
    let itemsPerPage = 12; // Increased for better grid view
    let totalPages = 1;
    let currentCarouselIndex = 0;
    let carouselItems = [];
    let searchTimeout;
    let filters = {
      search: '',
      country: '',
      gender: '',
      orientation: '',
      tags: ''
    };
    // DOM Elements
    const mobileMenuButton = document.getElementById('mobile-menu-button');
    const mobileMenu = document.getElementById('mobile-menu');
    const searchInput = document.getElementById('search-input');
    const mobileSearchInput = document.getElementById('mobile-search-input');
    const carouselItemsContainer = document.getElementById('carousel-items');
    const carouselIndicators = document.getElementById('carousel-indicators');
    const prevSlideButton = document.getElementById('prev-slide');
    const nextSlideButton = document.getElementById('next-slide');
    const broadcastsGrid = document.getElementById('broadcasts-grid');
    const loadingState = document.getElementById('loading-state');
    const errorState = document.getElementById('error-state');
    const emptyState = document.getElementById('empty-state');
    const retryButton = document.getElementById('retry-button');
    const pagination = document.getElementById('pagination');
    const pageNumbers = document.getElementById('page-numbers');
    const firstPageButton = document.getElementById('first-page');
    const prevPageButton = document.getElementById('prev-page');
    const nextPageButton = document.getElementById('next-page');
    const lastPageButton = document.getElementById('last-page');
    const topStreamersContainer = document.getElementById('top-streamers');
    const filterCountry = document.getElementById('filter-country');
    const filterGender = document.getElementById('filter-gender');
    const filterOrientation = document.getElementById('filter-orientation');
    const applyFiltersButton = document.getElementById('apply-filters');
    const surpriseMeBtn = document.getElementById('surprise-me-btn');
    const broadcastModal = document.getElementById('broadcast-modal');
    const closeModal = document.querySelector('.close-modal');
    const modalUsername = document.getElementById('modal-username');
    const modalAvatar = document.getElementById('modal-avatar');
    const modalCountryFlag = document.getElementById('modal-country-flag');
    const modalCountryName = document.getElementById('modal-country-name');
    const modalViewers = document.getElementById('modal-viewers');
    const modalGender = document.getElementById('modal-gender');
    const modalOrientation = document.getElementById('modal-orientation');
    const modalType = document.getElementById('modal-type');
    const modalTags = document.getElementById('modal-tags');
    const modalThumbnail = document.getElementById('modal-thumbnail');
    const modalIframe = document.getElementById('modal-iframe');
    const generateBioBtn = document.getElementById('generate-bio-btn');
    const geminiBioContent = document.getElementById('gemini-bio-content');
    const playButton = document.getElementById('play-button');
    const relatedBroadcasts = document.getElementById('related-broadcasts');
    const toast = document.getElementById('toast');
    const toastMessage = document.getElementById('toast-message');
    // Initialize the application
    document.addEventListener('DOMContentLoaded', () => {
      // --- AGE GATE MODAL LOGIC ---
      const ageGateModal = document.getElementById('age-gate-modal');
      const confirmBtn = document.getElementById('age-confirm-btn');
      const denyBtn = document.getElementById('age-deny-btn');
      const isAgeVerified = localStorage.getItem('ageVerified');
      if (!isAgeVerified) {
        ageGateModal.style.display = 'flex';
        document.body.style.overflow = 'hidden'; // Prevent scrolling behind the modal
      }
      confirmBtn.addEventListener('click', () => {
        localStorage.setItem('ageVerified', 'true');
        ageGateModal.style.display = 'none';
        document.body.style.overflow = 'auto';
      });
      denyBtn.addEventListener('click', () => {
        // Redirect to a neutral site
        window.location.href = 'https://www.google.com';
      });
      // --- END AGE GATE MODAL LOGIC ---
      initApp();
    });
    // Initialize the application
    async function initApp() {
      setupEventListeners();
      populateCountryFilter();
      // Fetch initial data for decoration (carousel, top streamers)
      await fetchInitialData();
      // Initialize main content based on URL parameters
      initializeFromUrl();
    }
    // Setup event listeners
    function setupEventListeners() {
      mobileMenuButton.addEventListener('click', toggleMobileMenu);
      searchInput.addEventListener('input', handleSearch);
      mobileSearchInput.addEventListener('input', handleSearch);
      prevSlideButton.addEventListener('click', showPrevSlide);
      nextSlideButton.addEventListener('click', showNextSlide);
      retryButton.addEventListener('click', () => {
        const params = new URLSearchParams(window.location.search);
        const page = parseInt(params.get('page'), 10) || 1;
        fetchBroadcasts(page, filters);
      });
      firstPageButton.addEventListener('click', () => goToPage(1));
      prevPageButton.addEventListener('click', () => goToPage(currentPage - 1));
      nextPageButton.addEventListener('click', () => goToPage(currentPage + 1));
      lastPageButton.addEventListener('click', () => goToPage(totalPages));
      applyFiltersButton.addEventListener('click', applyFilters);
      surpriseMeBtn.addEventListener('click', handleSurpriseMe);
      closeModal.addEventListener('click', closeModalHandler);
      window.addEventListener('click', (e) => {
        if (e.target === broadcastModal) closeModalHandler();
      });
    }
    // --- Gemini API Integration ---
    async function callGeminiAPI(prompt) {
      const apiKey = "AIzaSyAnXS2Mg_XlR78L1l08q5rSIsXvhwtt2L4"; // API key is handled by the environment
      const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
      const payload = {
        contents: [{
          parts: [{
            text: prompt
          }]
        }]
      };
      try {
        const response = await fetch(apiUrl, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(payload)
        });
        if (!response.ok) {
          const errorBody = await response.json();
          console.error("Gemini API Error:", errorBody);
          throw new Error(`API request failed with status ${response.status}`);
        }
        const result = await response.json();
        if (result.candidates && result.candidates.length > 0 &&
          result.candidates[0].content && result.candidates[0].content.parts &&
          result.candidates[0].content.parts.length > 0) {
          return result.candidates[0].content.parts[0].text;
        } else {
          console.error("Unexpected API response structure:", result);
          return null;
        }
      } catch (error) {
        console.error("Error calling Gemini API:", error);
        return null;
      }
    }
    async function handleSurpriseMe() {
      showToast('✨ A IA está buscando uma sugestão para você...');
      const prompt = `Sugira um tema criativo para encontrar streamers na plataforma XCam. Responda APENAS com um objeto JSON com as chaves "country", "gender", "orientation", e "search". Use os seguintes valores possíveis: country (br, us, es, fr, it, de, jp, kr, ru, ca), gender (male, female, trans, couple), orientation (straight, gay, lesbian, bisexual). A chave "search" deve ser um termo de busca criativo em português. Exemplo: {"country": "br", "gender": "male", "orientation": "gay", "search": "músicos tocando ao vivo"}`;
      const result = await callGeminiAPI(prompt);
      if (result) {
        try {
          const suggestion = JSON.parse(result);
          filterCountry.value = suggestion.country || '';
          filterGender.value = suggestion.gender || '';
          filterOrientation.value = suggestion.orientation || '';
          searchInput.value = suggestion.search || '';
          mobileSearchInput.value = suggestion.search || '';
          filters.search = suggestion.search || '';
          applyFilters();
        } catch (e) {
          console.error("Failed to parse Gemini suggestion:", e);
          showToast("Não foi possível aplicar a sugestão da IA.");
        }
      } else {
        showToast("A IA não conseguiu gerar uma sugestão. Tente novamente.");
      }
    }
    async function handleGenerateBio(broadcast) {
      const btn = document.getElementById('generate-bio-btn');
      btn.disabled = true;
      btn.innerHTML = `<span class="loader !w-6 !h-6 !border-4"></span> Gerando...`;
      geminiBioContent.classList.remove('hidden');
      geminiBioContent.textContent = 'Aguarde, a IA está coletando informações e criando uma biografia...';
      let additionalDetails = '';
      try {
        const userInfoResponse = await fetch(`https://api.xcam.gay/user/${broadcast.username}/Info`);
        if (userInfoResponse.ok) {
          const userInfo = await userInfoResponse.json();
          const details = [];
          if (userInfo.age) details.push(`Idade: ${userInfo.age}`);
          if (userInfo.ethnicity) details.push(`Etnia: ${userInfo.ethnicity}`);
          if (userInfo.maritalStatus) details.push(`Estado Civil: ${userInfo.maritalStatus}`);
          if (userInfo.hairColor) details.push(`Cor do Cabelo: ${userInfo.hairColor}`);
          if (userInfo.bodyHair) details.push(`Pelos Corporais: ${userInfo.bodyHair}`);
          if (userInfo.bodyDecorations && userInfo.bodyDecorations.length > 0) details.push(`Decorações Corporais: ${userInfo.bodyDecorations.join(', ')}`);
          if (userInfo.maleBodyType) details.push(`Tipo de Corpo: ${userInfo.maleBodyType}`);
          if (userInfo.maleRole) details.push(`Função: ${userInfo.maleRole}`);
          if (userInfo.bio && userInfo.bio.trim() !== '') {
            const cleanBio = userInfo.bio.replace(/\[.*?\]/g, '');
            details.push(`Bio Original: "${cleanBio}"`);
          }
          if (details.length > 0) {
            additionalDetails = `\n- Detalhes Adicionais: ${details.join('; ')}`;
          }
        }
      } catch (error) {
        console.error('Falha ao buscar informações adicionais do usuário:', error);
        // It will just proceed without additional details, which is a graceful fallback.
      }
      const prompt = `Crie uma biografia curta, criativa e envolvente em português para um(a) streamer da plataforma XCam com as seguintes informações:
        - Nome de usuário: ${broadcast.username}
        - País: ${getCountryName(broadcast.country)}
        - Gênero: ${TRANSLATIONS.gender[broadcast.gender] || broadcast.gender}
        - Orientação: ${TRANSLATIONS.sexPreference[broadcast.sexualOrientation] || broadcast.sexualOrientation}
        - Tags: ${broadcast.tags.map(t => t.name).join(', ')}${additionalDetails}

        Seja criativo e use um tom que combine com uma plataforma de streaming ao vivo. Não inclua informações que não foram fornecidas. Se a bio original for fornecida, use-a como inspiração para o tom e estilo, mas não a copie.`;
      const bio = await callGeminiAPI(prompt);
      if (bio) {
        geminiBioContent.textContent = bio;
      } else {
        geminiBioContent.textContent = 'Não foi possível gerar a biografia no momento.';
      }
      btn.disabled = false;
      btn.innerHTML = '✨ Gerar Biografia com IA';
    }
    // Toggle mobile menu
    function toggleMobileMenu() {
      mobileMenu.classList.toggle('hidden');
    }
    // Handle search input with debounce
    function handleSearch(e) {
      const searchTerm = e.target.value.toLowerCase();
      if (e.target === searchInput) mobileSearchInput.value = searchTerm;
      else searchInput.value = searchTerm;
      clearTimeout(searchTimeout);
      searchTimeout = setTimeout(() => {
        filters.search = searchTerm;
        filters.tags = searchTerm.replace(/ /g, ',');
        goToPage(1);
      }, 500);
    }
    // Apply filters from dropdowns
    function applyFilters() {
      filters.country = filterCountry.value;
      filters.gender = filterGender.value;
      filters.orientation = filterOrientation.value;
      goToPage(1);
      showToast('Filtros aplicados com sucesso!');
    }
    // Initialize filters and fetch data based on URL parameters
    function initializeFromUrl() {
      const params = new URLSearchParams(window.location.search);
      const page = parseInt(params.get('page'), 10) || 1;
      const limit = parseInt(params.get('limit'), 10) || 12;
      const country = params.get('country') || '';
      const tags = params.get('tags') || '';
      itemsPerPage = limit;
      currentPage = page;
      filters.country = country;
      filters.tags = tags;
      filters.search = tags.replace(/,/g, ' '); // Sync search input with tags
      // Update UI to reflect URL state
      filterCountry.value = country;
      searchInput.value = filters.search;
      mobileSearchInput.value = filters.search;
      fetchBroadcasts(currentPage, filters);
    }
    // Fetch initial data for Carousel and Top Streamers (unfiltered)
    async function fetchInitialData() {
      const API_URL = 'https://api.xcam.gay/';
      try {
        const response = await fetch(`${API_URL}?limit=12&page=1`);
        if (!response.ok) throw new Error('Failed to fetch initial data');
        const data = await response.json();
        const items = data.broadcasts.items || [];
        setupCarousel(items);
        setupTopStreamers(items);
      } catch (error) {
        console.error('Error fetching initial data:', error);
        // Handle error for these specific components if necessary
      }
    }
    // Fetch broadcasts for the main grid, respecting filters
    async function fetchBroadcasts(page = 1, queryFilters = {}) {
      showLoadingState();
      const API_URL = 'https://api.xcam.gay/';
      const params = new URLSearchParams({
        limit: itemsPerPage,
        page: page
      });
      // Append filters to params if they have values
      if (queryFilters.search) params.append('username', queryFilters.search);
      if (queryFilters.country) params.append('country', queryFilters.country);
      if (queryFilters.gender) params.append('gender', queryFilters.gender);
      if (queryFilters.orientation) params.append('sexualOrientation', queryFilters.orientation);
      if (queryFilters.tags) params.append('tags', queryFilters.tags);
      try {
        const response = await fetch(`${API_URL}?${params.toString()}`);
        if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
        const data = await response.json();
        const newItems = data.broadcasts.items || [];
        const totalBroadcasts = data.broadcasts.total || 0;
        const broadcastsTitle = document.getElementById('broadcasts-title');
        if (broadcastsTitle) {
          broadcastsTitle.textContent = `${totalBroadcasts.toLocaleString('pt-BR')} Transmissões ao Vivo`;
        }
        newItems.forEach(item => {
          if (!broadcasts.some(b => b.id === item.id)) {
            broadcasts.push(item);
          }
        });
        totalPages = data.broadcasts.totalPages;
        currentPage = page;
        renderBroadcasts(newItems);
      } catch (error) {
        console.error('Error fetching broadcasts:', error);
        showErrorState();
      }
    }
    // UI State Management
    function showLoadingState() {
      loadingState.classList.remove('hidden');
      broadcastsGrid.classList.add('hidden');
      errorState.classList.add('hidden');
      emptyState.classList.add('hidden');
      pagination.classList.add('hidden');
    }

    function showErrorState() {
      loadingState.classList.add('hidden');
      errorState.classList.remove('hidden');
    }

    function showEmptyState() {
      loadingState.classList.add('hidden');
      emptyState.classList.remove('hidden');
    }

    function showBroadcastsGrid() {
      loadingState.classList.add('hidden');
      broadcastsGrid.classList.remove('hidden');
      pagination.classList.remove('hidden');
      errorState.classList.add('hidden');
      emptyState.classList.add('hidden');
    }
    // Setup UI Components
    function populateCountryFilter() {
      const selectElement = document.getElementById('filter-country');
      // Sort countries by name for better UX
      const sortedCountries = Object.entries(COUNTRY_NAMES)
        .sort(([, nameA], [, nameB]) => nameA.localeCompare(nameB));
      for (const [code, name] of sortedCountries) {
        if (code === 'other') continue; // Skip 'other' category
        const option = document.createElement('option');
        option.value = code;
        option.textContent = name;
        selectElement.appendChild(option);
      }
    }

    function setupCarousel(items) {
      if (!items || items.length === 0) return;
      carouselItems = items.slice(0, 5);
      carouselItemsContainer.innerHTML = '';
      carouselIndicators.innerHTML = '';
      carouselItems.forEach((broadcast, index) => {
        const posterUrl = `https://api.xcam.gay/poster/${broadcast.username}.jpg`;
        const item = document.createElement('div');
        item.className = `carousel-item opacity-0`;
        item.dataset.username = broadcast.username; // Store username for iframe
        item.innerHTML = `
          <div class="carousel-media-container absolute inset-0 bg-black">
             <img src="${posterUrl}" alt="${broadcast.username}" class="w-full h-full object-cover">
          </div>
          <div class="absolute inset-0 bg-gradient-to-t from-black to-transparent z-10"></div>
          <div class="absolute bottom-0 left-0 p-6 z-20">
            <span class="bg-xcam-pink text-white px-2 py-1 rounded-md text-sm font-medium mb-2 inline-block">AO VIVO</span>
            <h2 class="text-2xl md:text-3xl font-bold text-white mb-1">@${broadcast.username}</h2>
            <p class="text-gray-300 mb-3">${broadcast.viewers} espectadores</p>
            <button class="bg-white text-black px-6 py-2 rounded-full font-medium hover:bg-opacity-90 transition-colors" onclick="openModal('${broadcast.id}')">Assistir</button>
          </div>
        `;
        carouselItemsContainer.appendChild(item);
        const indicator = document.createElement('button');
        indicator.className = `w-3 h-3 rounded-full ${index === 0 ? 'bg-white' : 'bg-gray-500'}`;
        indicator.addEventListener('click', () => goToSlide(index));
        carouselIndicators.appendChild(indicator);
      });
      goToSlide(0); // Initialize the first slide with an iframe
      startCarouselRotation();
    }

    function startCarouselRotation() {
      setInterval(showNextSlide, 15000);
    }

    function goToSlide(index) {
      const items = document.querySelectorAll('.carousel-item');
      const indicators = document.querySelectorAll('#carousel-indicators button');
      items.forEach((item, i) => {
        const mediaContainer = item.querySelector('.carousel-media-container');
        if (i === index) {
          item.classList.remove('opacity-0');
          // Se não existe um poster, adiciona
          if (!mediaContainer.querySelector('img')) {
            const broadcast = carouselItems[i];
            const posterUrl = `https://api.xcam.gay/poster/${broadcast.username}.jpg`;
            mediaContainer.innerHTML = `<img src="${posterUrl}" alt="${broadcast.username}" class="w-full h-full object-cover carousel-poster">`;
          }
          // Se não existe um loader, adiciona
          if (!mediaContainer.querySelector('.carousel-loader')) {
            const loader = document.createElement('div');
            loader.className = 'carousel-loader absolute inset-0 flex items-center justify-center bg-black bg-opacity-50 z-10';
            loader.innerHTML = '<span class="loader"></span>';
            mediaContainer.appendChild(loader);
          }
          // Se não existe um iframe, adiciona
          if (!mediaContainer.querySelector('iframe')) {
            const username = item.dataset.username;
            const iframe = document.createElement('iframe');
            iframe.className = 'w-full h-full border-0 absolute inset-0';
            iframe.src = `https://player.xcam.gay/hls/?user=${username}`;
            iframe.setAttribute('allow', 'autoplay; encrypted-media');
            iframe.style.opacity = '0';
            iframe.onload = () => {
              // Remove loader
              const loader = mediaContainer.querySelector('.carousel-loader');
              if (loader) loader.remove();
              // Remove poster
              const poster = mediaContainer.querySelector('.carousel-poster');
              if (poster) poster.remove();
              iframe.style.opacity = '1';
            };
            mediaContainer.appendChild(iframe);
          }
        } else {
          item.classList.add('opacity-0');
          // Remove iframe e loader, restaura poster
          const broadcast = carouselItems[i];
          const posterUrl = `https://api.xcam.gay/poster/${broadcast.username}.jpg`;
          mediaContainer.innerHTML = `<img src="${posterUrl}" alt="${broadcast.username}" class="w-full h-full object-cover carousel-poster">`;
        }
      });
      indicators.forEach((indicator, i) => {
        indicator.classList.toggle('bg-white', i === index);
        indicator.classList.toggle('bg-gray-500', i !== index);
      });
      currentCarouselIndex = index;
    }

    function showPrevSlide() {
      let newIndex = currentCarouselIndex - 1;
      if (newIndex < 0) newIndex = carouselItems.length - 1;
      goToSlide(newIndex);
    }

    function showNextSlide() {
      let newIndex = currentCarouselIndex + 1;
      if (newIndex >= carouselItems.length) newIndex = 0;
      goToSlide(newIndex);
    }

    function setupTopStreamers(items) {
      if (!items || items.length === 0) return;
      const topStreamers = [...items].sort((a, b) => b.viewers - a.viewers).slice(0, 5);
      topStreamersContainer.innerHTML = '';
      topStreamers.forEach(streamer => {
        const item = document.createElement('div');
        item.className = 'flex items-center space-x-3 p-2 rounded-lg hover:bg-gray-800 transition-colors cursor-pointer';
        item.onclick = () => openModal(streamer.id);
        item.innerHTML = `
          <img src="${streamer.profileImageURL}" alt="${streamer.username}" class="w-10 h-10 rounded-full object-cover">
          <div>
            <h4 class="font-medium text-white">@${streamer.username}</h4>
            <div class="flex items-center text-sm text-gray-400">
              <span class="flag-icon" style="background-image: url(https://flagcdn.com/w20/${streamer.country}.png)"></span>
              <span>${streamer.viewers} espectadores</span>
            </div>
          </div>
        `;
        topStreamersContainer.appendChild(item);
      });
    }
    /**
     * Handles the mouse entering the preview area of a broadcast card.
     * It creates and displays an iframe for a live preview.
     * @param {MouseEvent} event The mouseenter event.
     */
    function handleCardHover(event) {
      const previewContainer = event.currentTarget;
      const username = previewContainer.dataset.username;
      if (!username) return;
      // Find existing elements
      const poster = previewContainer.querySelector('.card-poster');
      // If an iframe is already there, do nothing
      if (previewContainer.querySelector('iframe')) return;
      // Create a loader element
      const loader = document.createElement('div');
      loader.className = 'card-loader absolute inset-0 flex items-center justify-center bg-black bg-opacity-50 z-10';
      loader.innerHTML = '<span class="loader"></span>';
      previewContainer.appendChild(loader);
      // Create the iframe for the live preview
      const iframe = document.createElement('iframe');
      iframe.style.opacity = '0'; // Start hidden
      iframe.className = 'absolute inset-0 w-full h-full border-0 transition-opacity duration-300 aspect-video';
      iframe.src = `https://player.xcam.gay/hls/?user=${username}`;
      iframe.setAttribute('frameborder', '0');
      iframe.setAttribute('allow', 'autoplay; encrypted-media');
      iframe.setAttribute('allowfullscreen', 'true');
      // When the iframe has loaded, fade it in and remove the loader
      iframe.onload = () => {
        if (loader) loader.remove();
        if (poster) poster.style.display = 'none'; // Hide poster completely
        iframe.style.opacity = '1';
      };
      // Add the iframe to the container, but before the overlays
      const badge = previewContainer.querySelector('.badge-live');
      const viewers = previewContainer.querySelector('div.absolute.bottom-2.right-2');
      previewContainer.insertBefore(iframe, badge);
    }
    /**
     * Handles the mouse leaving the preview area of a broadcast card.
     * It removes the iframe and restores the poster image.
     * @param {MouseEvent} event The mouseleave event.
     */
    function handleCardMouseLeave(event) {
      const previewContainer = event.currentTarget;
      // Find elements
      const poster = previewContainer.querySelector('.card-poster');
      const iframe = previewContainer.querySelector('iframe');
      const loader = previewContainer.querySelector('.card-loader');
      // Restore the poster image
      if (poster) {
        poster.style.display = 'block';
      }
      // Stop and remove the iframe and loader
      if (iframe) {
        iframe.src = 'about:blank';
        iframe.remove();
      }
      if (loader) {
        loader.remove();
      }
    }
    // Render broadcasts grid
    function renderBroadcasts(broadcastsList) {
      if (!broadcastsList || broadcastsList.length === 0) {
        showEmptyState();
        return;
      }
      broadcastsGrid.innerHTML = '';
      broadcastsList.forEach(broadcast => {
        const posterUrl = `https://api.xcam.gay/poster/${broadcast.username}.jpg`;
        const card = document.createElement('div');
        card.className = 'bg-gray-900 rounded-xl overflow-hidden border border-gray-800 transition-all duration-300 card-hover flex flex-col max-w-full';
        // tags com classe card-tag para efeito gradiente
        const tagsHTML = broadcast.tags && broadcast.tags.length > 0 ?
          broadcast.tags.map(tag => `<span class="card-tag">#${tag.name}</span>`).join(' ') :
          '';
        card.innerHTML = `
          <div class="relative card-preview-container aspect-video cursor-pointer">
            <img src="${posterUrl}" alt="${broadcast.username}" class="card-poster w-full aspect-video object-cover pointer-events-none">
            <span class="badge-live absolute top-2 right-2 px-2 py-1 rounded-md text-white text-xs font-medium z-20">AO VIVO</span>
            <div class="absolute bottom-2 right-2 bg-black bg-opacity-70 px-2 py-1 rounded-md text-white text-xs flex items-center z-20">
              <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path></svg>
              ${broadcast.viewers}
            </div>
            <div class="absolute inset-0 z-30 cursor-pointer card-click-overlay"></div>
          </div>
          <div class="p-4 card-info-container">
            <div class="flex items-center justify-between mb-2">
              <h3 class="font-bold text-white">@${broadcast.username}</h3>
              <span class="flag-icon" style="background-image: url(https://flagcdn.com/w20/${broadcast.country}.png)" title="${getCountryName(broadcast.country)}" alt="${getCountryName(broadcast.country)}"></span>
            </div>
            <div class="flex flex-wrap gap-2 mb-2">
              <span class="bg-gray-800 text-gray-300 px-2 py-1 rounded-full text-xs flex items-center">
                <img src="${GENDER_ICON_SVG}" class="w-3 h-3 mr-1.5" alt="Gender Icon">
                ${TRANSLATIONS.gender[broadcast.gender] || broadcast.gender}
              </span>
              <span class="bg-gray-800 text-gray-300 px-2 py-1 rounded-full text-xs flex items-center">
                <img src="${ORIENTATION_ICON_SVG}" class="w-3 h-3 mr-1.5" alt="Orientation Icon">
                ${TRANSLATIONS.sexPreference[broadcast.sexualOrientation] || broadcast.sexualOrientation}
              </span>
              <span class="bg-gray-800 text-gray-300 px-2 py-1 rounded-full text-xs flex items-center">
                <img src="${BROADCAST_TYPE_ICON_SVG}" class="w-3 h-3 mr-1.5" alt="Broadcast Type Icon">
                ${TRANSLATIONS.broadcastType[broadcast.broadcastType] || broadcast.broadcastType}
              </span>
            </div>
            <div class="flex flex-wrap gap-1 mt-2">${tagsHTML}</div>
          </div>
        `;
        // Find the new containers inside the card
        const previewContainer = card.querySelector('.card-preview-container');
        previewContainer.dataset.username = broadcast.username;
        previewContainer.style.cursor = 'pointer';
        card.addEventListener('mouseenter', function(e) {
          handleCardHover({
            currentTarget: previewContainer
          });
        });
        card.addEventListener('mouseleave', function(e) {
          handleCardMouseLeave({
            currentTarget: previewContainer
          });
        });
        const clickOverlay = previewContainer.querySelector('.card-click-overlay');
        clickOverlay.addEventListener('click', (e) => {
          e.stopPropagation();
          openModal(broadcast.id);
        });
        // Adiciona evento de clique nas tags para filtrar
        const tagElements = card.querySelectorAll('.card-tag');
        tagElements.forEach(tagEl => {
          tagEl.addEventListener('click', (e) => {
            e.stopPropagation();
            const tagName = tagEl.textContent.replace('#', '').trim();
            filters.tags = tagName;
            searchInput.value = tagName;
            mobileSearchInput.value = tagName;
            goToPage(1);
          });
        });
        broadcastsGrid.appendChild(card);
      });
      updatePagination();
      showBroadcastsGrid();
    }
    // Pagination Logic
    function updatePagination() {
      pageNumbers.innerHTML = '';
      let isMobile = window.innerWidth < 640;
      let startPage, endPage;
      if (isMobile) {
        // Mostra só 3 páginas
        startPage = Math.max(1, currentPage - 1);
        endPage = Math.min(totalPages, startPage + 2);
        if (endPage - startPage < 2) {
          startPage = Math.max(1, endPage - 2);
        }
      } else {
        startPage = Math.max(1, currentPage - 2);
        endPage = Math.min(totalPages, currentPage + 2);
        if (endPage - startPage < 4) {
          if (startPage === 1) endPage = Math.min(5, totalPages);
          else if (endPage === totalPages) startPage = Math.max(1, totalPages - 4);
        }
      }
      for (let i = startPage; i <= endPage; i++) {
        const pageButton = document.createElement('button');
        pageButton.className = `pagination-btn w-8 h-8 flex items-center justify-center rounded-md text-sm ${i === currentPage ? 'pagination-active' : 'bg-gray-800 hover:bg-gray-700'}`;
        pageButton.textContent = i;
        pageButton.addEventListener('click', () => goToPage(i));
        pageNumbers.appendChild(pageButton);
      }
      // Botões de navegação
      if (isMobile) {
        // Primeira página: seta dupla para a esquerda
        firstPageButton.innerHTML = `<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 19l-7-7 7-7" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 19l-7-7 7-7" /></svg>`;
        // Anterior: seta simples para a esquerda
        prevPageButton.innerHTML = `<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" /></svg>`;
        // Próxima: seta simples para a direita
        nextPageButton.innerHTML = `<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" /></svg>`;
        // Última página: seta dupla para a direita
        lastPageButton.innerHTML = `<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 5l7 7-7 7" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 5l7 7-7 7" /></svg>`;
        firstPageButton.title = "Primeira";
        prevPageButton.title = "Anterior";
        nextPageButton.title = "Próxima";
        lastPageButton.title = "Última";
      } else {
        firstPageButton.textContent = "Primeira";
        prevPageButton.textContent = "Anterior";
        nextPageButton.textContent = "Próxima";
        lastPageButton.textContent = "Última";
      }
      [firstPageButton, prevPageButton].forEach(btn => btn.disabled = currentPage === 1);
      [nextPageButton, lastPageButton].forEach(btn => btn.disabled = currentPage === totalPages);
      [firstPageButton, prevPageButton, nextPageButton, lastPageButton].forEach(button => {
        button.classList.toggle('opacity-50', button.disabled);
        button.classList.toggle('cursor-not-allowed', button.disabled);
      });
    }

    function goToPage(page) {
      // Correction: Allow navigation to page 1 even if totalPages is 0 (for new searches)
      if (page < 1 || (page > totalPages && page !== 1)) return;
      currentPage = page;
      updateUrl();
      fetchBroadcasts(currentPage, filters);
    }

    function updateUrl() {
      const params = new URLSearchParams();
      if (itemsPerPage !== 12) params.set('limit', itemsPerPage);
      if (currentPage > 1) params.set('page', currentPage);
      if (filters.country) params.set('country', filters.country);
      if (filters.tags) params.set('tags', filters.tags);
      // Add other filters from the state if they should be reflected in the URL
      if (filters.gender) params.set('gender', filters.gender);
      if (filters.orientation) params.set('sexualOrientation', filters.orientation);
      const newUrl = `${window.location.pathname}?${params.toString()}`;
      history.pushState({
        path: newUrl
      }, '', newUrl);
    }
    // Modal Logic
    function openModal(broadcastId) {
      const broadcast = broadcasts.find(b => b.id === broadcastId);
      if (!broadcast) {
        showToast('Transmissão não encontrada. Tente recarregar.');
        return;
      }
      // Populate text and static info
      modalUsername.textContent = `@${broadcast.username}`;
      modalAvatar.src = broadcast.profileImageURL;
      modalCountryFlag.style.backgroundImage = `url(https://flagcdn.com/w20/${broadcast.country}.png)`;
      modalCountryName.textContent = getCountryName(broadcast.country);
      modalViewers.textContent = broadcast.viewers;
      modalGender.innerHTML = `<img src="${GENDER_ICON_SVG}" class="w-4 h-4 mr-2" alt="Gender Icon">${TRANSLATIONS.gender[broadcast.gender] || broadcast.gender}`;
      modalOrientation.innerHTML = `<img src="${ORIENTATION_ICON_SVG}" class="w-4 h-4 mr-2" alt="Orientation Icon">${TRANSLATIONS.sexPreference[broadcast.sexualOrientation] || broadcast.sexualOrientation}`;
      modalType.innerHTML = `<img src="${BROADCAST_TYPE_ICON_SVG}" class="w-4 h-4 mr-2" alt="Broadcast Type Icon">${TRANSLATIONS.broadcastType[broadcast.broadcastType] || broadcast.broadcastType}`;
      // Populate tags
      modalTags.innerHTML = '';
      if (broadcast.tags && broadcast.tags.length > 0) {
        broadcast.tags.forEach(tag => {
          const tagElement = document.createElement('span');
          tagElement.className = 'bg-xcam-blue bg-opacity-30 text-xcam-blue px-3 py-1 rounded-full text-sm cursor-pointer hover:bg-opacity-50 transition-colors';
          tagElement.textContent = `#${tag.name}`;
          tagElement.addEventListener('click', () => {
            filters.tags = tag.name;
            searchInput.value = tag.name;
            mobileSearchInput.value = tag.name;
            closeModalHandler();
            goToPage(1);
          });
          modalTags.appendChild(tagElement);
        });
      }
      // Reset and setup Gemini Bio section
      geminiBioContent.classList.add('hidden');
      geminiBioContent.textContent = '';
      generateBioBtn.onclick = () => handleGenerateBio(broadcast);
      generateBioBtn.disabled = false;
      generateBioBtn.innerHTML = '✨ Gerar Biografia com IA';
      // Construct the new iframe URL
      const posterUrl = encodeURIComponent(`https://api.xcam.gay/poster/${broadcast.username}.jpg`);
      const tagsString = broadcast.tags ? encodeURIComponent(broadcast.tags.map(tag => tag.name).join(',')) : '';
      const iframeUrl = `https://xcam.gay/player/?user=${broadcast.username}&img=${posterUrl}&tags=${tagsString}`;
      // Set iframe source and show it, hide the thumbnail/play button
      modalIframe.src = iframeUrl;
      document.getElementById('modal-player').classList.add('hidden');
      modalIframe.classList.remove('hidden');
      // Populate related broadcasts
      const related = broadcasts.filter(b => b.id !== broadcastId && (b.gender === broadcast.gender || b.sexualOrientation === broadcast.sexualOrientation)).slice(0, 3);
      relatedBroadcasts.innerHTML = '';
      related.forEach(r => {
        const item = document.createElement('div');
        item.className = 'cursor-pointer hover:opacity-90 transition-opacity';
        item.onclick = () => openModal(r.id);
        item.innerHTML = `
          <div class="relative"><img src="https://api.xcam.gay/poster/${r.username}.jpg" alt="${r.username}" class="w-full aspect-video object-cover rounded-lg"><span class="badge-live absolute top-2 right-2 px-2 py-1 rounded-md text-white text-xs font-medium">AO VIVO</span></div>
          <h4 class="font-medium text-white mt-2">@${r.username}</h4>
          <div class="flex items-center text-sm text-gray-400"><span class="flag-icon" style="background-image: url(https://flagcdn.com/w20/${r.country}.png)"></span><span>${r.viewers} espectadores</span></div>
        `;
        relatedBroadcasts.appendChild(item);
      });
      // Show the modal
      broadcastModal.style.display = 'block';
      document.body.style.overflow = 'hidden';
    }

    function closeModalHandler() {
      broadcastModal.style.display = 'none';
      document.body.style.overflow = 'auto';
      modalIframe.src = '';
    }
    // Utility Functions
    function showToast(message) {
      toastMessage.textContent = message;
      toast.classList.remove('hidden');
      setTimeout(() => toast.classList.add('hidden'), 3000);
    }

    function getCountryName(countryCode) {
      return COUNTRY_NAMES[countryCode] || countryCode.toUpperCase();
    }
    // Make functions available globally for inline onclick attributes
    window.openModal = openModal;
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/sw.js')
          .then(registration => {
            console.log('Service Worker registrado com sucesso:', registration);
          })
          .catch(error => {
            console.log('Falha ao registrar o Service Worker:', error);
          });
      });
    }
  </script>
</body>

</html>
